<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dta.dao.IOrderRecordDao">
<!-- **********增加对象********** -->
<insert id="addObject" parameterType="OrderRecord" keyProperty="order_id" useGeneratedKeys="true">
	insert into order_record 
	<set>
		<if test="student_id != null and student_id != ''">
			student_id = #{student_id},
		</if>
		<if test="coach_id != null and coach_id != ''">
			coach_id = #{coach_id},
		</if>
		<if test="school_id != null and school_id != ''">
			school_id = #{school_id},
		</if>
		<if test="order_time != null and order_time != ''">
			order_time = #{order_time},
		</if>
		<if test="order_amount != null and order_amount != ''">
			order_amount = #{order_amount},
		</if>
		<if test="order_status != null and order_status != ''">
			order_status = #{order_status},
		</if>
		<if test="training_start_time != null and training_start_time != ''">
			training_start_time = #{training_start_time},
		</if>
		<if test="training_end_time != null and training_end_time != ''">
			training_end_time = #{training_end_time},
		</if>
		<if test="order_dead_time != null and order_dead_time != ''">
			order_dead_time = #{order_dead_time},
		</if>
		<if test="order_memo != null and order_memo != ''">
			order_memo = #{order_memo},
		</if>
		<if test="validation != null and validation != ''">
			validation = #{validation},
		</if>
		<if test="course_status != null and course_status != ''">
			course_status = #{course_status},
		</if>
	</set>
</insert>
<!-- **********删除对象********** -->
<update id="deleteMultiData">
	update order_record set validation = 0 
	where order_id in 
	<foreach item="item" index="index" collection="list"
		 open="(" separator="," close=")">
			 #{item}
	</foreach>
</update>
<!-- **********删除一个对象********* -->
<update id="deleteObjectById" parameterType="int">
	update order_record set validation = 0 where order_id = #{order_id}
</update>
<!-- **********获取所有对象********* -->
<select id="getAll" resultType="OrderRecord" parameterType="OrderRecordVo">
	select 
	 	R.order_id,
	 	R.student_id,
	 	R.coach_id,
	 	R.school_id,
	 	R.course_status,
	 	R.order_time,
	 	R.order_amount,
	 	R.order_status,
	 	R.training_start_time,
	 	R.training_end_time,
	 	R.order_dead_time,
	 	R.order_memo,
	 	coach.coach_name,
	 	coach.phone,
	 	S.school_address,
	 	IF((coach.photo IS NULL), 0, 1) AS havePhoto
	from 
			order_record as R 
		join 
			coach_basic_info as coach 
		on 
			R.coach_id = coach.coach_id
		join 
			school_info as S
		on 
			R.school_id = S.school_id
	<where>
		R.validation = 1
		and coach.validation = 1
		and S.validation = 1
		<if test="order_id != null and order_id != '' ">
			and order_id = #{order_id}
		</if>
		<if test="student_id != null and student_id != '' ">
			and student_id = #{student_id}
		</if>
		<if test="coach_id != null and coach_id != '' ">
			and R.coach_id = #{coach_id}
		</if>
		<if test="school_id != null and school_id != '' ">
			and school_id = #{school_id}
		</if>
		<if test="order_time != null and order_time != '' ">
			and order_time like "%"#{order_time}"%"
		</if>
		<if test="order_amount != null and order_amount != '' ">
			and order_amount = #{order_amount}
		</if>
		<if test="order_status != null and order_status != '' ">
			and order_status = #{order_status}
		</if>
		<if test="training_start_time != null and training_start_time != '' ">
			and training_start_time like "%"#{training_start_time}"%"
		</if>
		<if test="training_end_time != null and training_end_time != '' ">
			and training_end_time like "%"#{training_end_time}"%"
		</if>
		<if test="order_dead_time != null and order_dead_time != '' ">
			and order_dead_time like "%"#{order_dead_time}"%"
		</if>
		<if test="order_memo != null and order_memo != '' ">
			and order_memo like "%"#{order_memo}"%"
		</if>
		<if test="validation != null and validation != '' ">
			and validation = #{validation}
		</if>
		<if test="course_status != null and course_status != '' ">
			and course_status = #{course_status}
		</if>
	</where>
	order by R.training_start_time DESC
</select>
<!-- **********获取一个对象********* -->
<select id="getObjectById" resultType="OrderRecord" parameterType="int">
	select * from order_record
	where order_id = #{order_id} and validation = 1
</select>
<!-- **********获取一页对象********** -->
<select id="getPage" resultType="OrderRecord" parameterType="OrderRecord">
	select 
	 	R.order_id,
	 	R.student_id,
	 	R.coach_id,
	 	R.school_id,
	 	R.course_status,
	 	R.order_time,
	 	R.order_amount,
	 	R.order_status,
	 	R.training_start_time,
	 	R.training_end_time,
	 	R.order_dead_time,
	 	R.order_memo,
	 	coach.coach_name,
	 	coach.phone,
	 	coach.training_place,
	 	IF((coach.photo IS NULL), 0, 1) AS havePhoto
	from 
		order_record as R 
		join 
		coach_basic_info as coach 
		on 
		R.coach_id = coach.coach_id
	<where>
		R.validation = 1
		and coach.validation = 1
		<if test="order_id != null and order_id != '' ">
			and order_id = #{order_id}
		</if>
		<if test="student_id != null and student_id != '' ">
			and student_id = #{student_id}
		</if>
		<if test="coach_id != null and coach_id != '' ">
			and R.coach_id = #{coach_id}
		</if>
		<if test="school_id != null and school_id != '' ">
			and school_id = #{school_id}
		</if>
		<if test="order_time != null and order_time != '' ">
			and order_time like "%"#{order_time}"%"
		</if>
		<if test="order_amount != null and order_amount != '' ">
			and order_amount = #{order_amount}
		</if>
		<if test="order_status != null and order_status != '' ">
			and order_status = #{order_status}
		</if>
		<if test="training_start_time != null and training_start_time != '' ">
			and training_start_time like "%"#{training_start_time}"%"
		</if>
		<if test="training_end_time != null and training_end_time != '' ">
			and training_end_time like "%"#{training_end_time}"%"
		</if>
		<if test="order_dead_time != null and order_dead_time != '' ">
			and order_dead_time like "%"#{order_dead_time}"%"
		</if>
		<if test="order_memo != null and order_memo != '' ">
			and order_memo like "%"#{order_memo}"%"
		</if>
		<if test="validation != null and validation != '' ">
			and validation = #{validation}
		</if>
		<if test="course_status != null and course_status != '' ">
			and course_status = #{course_status}
		</if>
	</where>
	<if test="sort != null">
		order by #{sort} #{order}
	</if>
	LIMIt #{page}, #{rows}
</select>
<!-- **********获取总数********* -->
<select id="getSize" resultType="int" parameterType="OrderRecord">
	select 
	count(R.order_id) 
	from 
		order_record as R 
		join 
		coach_basic_info as coach 
		on 
		R.coach_id = coach.coach_id
	<where>
		R.validation = 1
		and coach.validation = 1
		<if test="order_id != null and order_id != '' ">
			and order_id = #{order_id}
		</if>
		<if test="student_id != null and student_id != '' ">
			and student_id = #{student_id}
		</if>
		<if test="coach_id != null and coach_id != '' ">
			and coach_id = #{coach_id}
		</if>
		<if test="school_id != null and school_id != '' ">
			and school_id = #{school_id}
		</if>
		<if test="order_time != null and order_time != '' ">
			and order_time like "%"#{order_time}"%"
		</if>
		<if test="order_amount != null and order_amount != '' ">
			and order_amount = #{order_amount}
		</if>
		<if test="order_status != null and order_status != '' ">
			and order_status = #{order_status}
		</if>
		<if test="training_start_time != null and training_start_time != '' ">
			and training_start_time like "%"#{training_start_time}"%"
		</if>
		<if test="training_end_time != null and training_end_time != '' ">
			and training_end_time like "%"#{training_end_time}"%"
		</if>
		<if test="order_dead_time != null and order_dead_time != '' ">
			and order_dead_time like "%"#{order_dead_time}"%"
		</if>
		<if test="order_memo != null and order_memo != '' ">
			and order_memo like "%"#{order_memo}"%"
		</if>
		<if test="validation != null and validation != '' ">
			and validation = #{validation}
		</if>
		<if test="course_status != null and course_status != '' ">
			and course_status = #{course_status}
		</if>
	</where>
</select>
<!-- *********更新对象********* -->
<update id="updateObjectById" parameterType="OrderRecord">
	update order_record
	<set>
		<if test="student_id != null and student_id != ''">
			student_id = #{student_id},
		</if>
		<if test="coach_id != null and coach_id != ''">
			coach_id = #{coach_id},
		</if>
		<if test="school_id != null and school_id != ''">
			school_id = #{school_id},
		</if>
		<if test="order_time != null and order_time != ''">
			order_time = #{order_time},
		</if>
		<if test="order_amount != null and order_amount != ''">
			order_amount = #{order_amount},
		</if>
		<if test="order_status != null and order_status != ''">
			order_status = #{order_status},
		</if>
		<if test="training_start_time != null and training_start_time != ''">
			training_start_time = #{training_start_time},
		</if>
		<if test="training_end_time != null and training_end_time != ''">
			training_end_time = #{training_end_time},
		</if>
		<if test="order_dead_time != null and order_dead_time != ''">
			order_dead_time = #{order_dead_time},
		</if>
		<if test="order_memo != null and order_memo != ''">
			order_memo = #{order_memo},
		</if>
		<if test="validation != null and validation != ''">
			validation = #{validation},
		</if>
		<if test="course_status != null and course_status != ''">
			course_status = #{course_status},
		</if>
		<if test="operation != null and operation != ''">
			operation = #{operation},
		</if>
		<if test="operator != null and operator != ''">
			operator = #{operator},
		</if>
	</set>
	where order_id =  #{order_id}
</update>
<!-- 获取教练的预约信息 -->
<select id="getCoPreRecord" resultType="CoachPrecontractRecord" parameterType="CoachPrecontractRecordVo">
	select 
		S.student_name,
		S.student_phone,
		S.student_id,
		O.coach_id,
		O.order_id,
		O.school_id,
		O.course_status,
		O.order_time,
		O.training_start_time,
		O.training_end_time,
		O.order_status
	from 
		order_record as O
	join 
		student_basic_info as S
	on 
		O.student_id = S.student_id
	<where>
		O.coach_id = #{coach_id} and
		S.validation = 1
	</where>
	<if test="sort != null and order != null">
		order by ${sort}  ${order}
	</if>
	<if test="page != null and rows != null  and rows != 0">
		limit #{page}, #{rows}
	</if>
</select>
<!-- 学员训练记录 -->
<select id="getStuTranRecord" resultType="TrainingRecord" parameterType="TrainingRecordVo">
	select 
		O.order_id,
		O.training_start_time,
		O.order_status,
		O.order_amount,
		O.order_dead_time,
		O.order_time,
		S.student_id,
		S.student_name,
		C.coach_id,
		C.coach_name,
		C.phone,
		C.star,
		SC.school_id
	from 
		order_record as O
	join 
		student_basic_info as S
	on 
		O.student_id = S.student_id
	join 
		coach_basic_info as C
	on 
		O.coach_id = C.coach_id
	join 
		school_info as SC
	on 
		O.school_id = SC.school_id
	<where>
		O.student_id = #{student_id} and
		O.student_id = S.student_id and
		O.coach_id = C.coach_id and
		O.school_id = SC.school_id and 
		O.validation = 1
	</where>
	<if test="sort != null and order != null and sort != '' and order != ''">
		order by ${sort} ${order}
	</if>
	<if test="rows != 0 and rows != null">
		limit #{page}, #{rows}
	</if>
</select>
<select id="getStuTranRecordSize" resultType="int" parameterType="TrainingRecordVo">
	select 
		count(O.order_id) as recordSize
	from 
		order_record as O
	join 
		student_basic_info as S
	on 
		O.student_id = S.student_id
	join 
		coach_basic_info as C
	on 
		O.coach_id = C.coach_id
	join 
		school_info as SC
	on 
		O.school_id = SC.school_id
	<where>
		O.student_id = #{student_id} and
		O.student_id = S.student_id and
		O.coach_id = C.coach_id and
		O.school_id = SC.school_id and 
		O.validation = 1
	</where>
</select>
</mapper>
